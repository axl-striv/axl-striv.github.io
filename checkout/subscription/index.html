<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">

  <title>AI Running Coach + Smart Insoles - Striv‚Ñ¢</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <main class="container">
    <div class="header">
      <h1>Striv‚Ñ¢</h1>
      <p class="header-subtitle">Complete your AI Running Coach setup</p>
      
      <!-- Progress indicator -->
      <div class="progress-steps">
        <div class="step completed">
          <div class="step-number">1</div>
          <div class="step-label">Hardware</div>
        </div>
        <div class="step active">
          <div class="step-number">2</div>
          <div class="step-label">AI Coach Plan</div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-label">Checkout</div>
        </div>
      </div>
    </div>

    <form id="checkout-form">
      <!-- Value Proposition Section -->
      <section class="card value-proposition" aria-labelledby="value-heading">
        <div class="value-content">
          <h2 id="value-heading">Your Complete AI Running Coach System</h2>
          <p class="value-subtitle">Smart hardware + AI coaching + fresh smart insoles delivered to your door</p>
          
          <!-- Hardware Showcase -->
          <div class="hardware-showcase">
            <div class="hardware-visual">
              <img src="../assets/x1_pack.webp" alt="Striv‚Ñ¢ Smart Sensor Hardware">
            </div>
            <div class="hardware-details">
              <h3>üèÉ‚Äç‚ôÇÔ∏è Advanced Running Analytics</h3>
              <div class="hardware-specs">
                <div class="spec-item">
                  <span class="spec-icon">‚ö°</span>
                  <div class="spec-content">
                    <strong>250+ Sensors</strong>
                    <p>Real-time data collection from every step</p>
                  </div>
                </div>
                <div class="spec-item">
                  <span class="spec-icon">üîã</span>
                  <div class="spec-content">
                    <strong>20+ Hour Battery</strong>
                    <p>Extended training sessions without interruption</p>
                  </div>
                </div>
                <div class="spec-item">
                  <span class="spec-icon">üì°</span>
                  <div class="spec-content">
                    <strong>Wireless Connectivity</strong>
                    <p>Seamless data sync to your smartphone</p>
                  </div>
                </div>
              </div>
              <div class="hardware-price">
                <div class="price-label">Hardware (one-time payment)</div>
                <div class="price-value">$129</div>
              </div>
            </div>
          </div>

          <!-- Subscription Services
          <div class="services-grid">
            <div class="service-item">
              <div class="service-icon">üß†</div>
              <div class="service-content">
                <h4>AI Running Coach</h4>
                <p>Personalized training plans and real-time feedback</p>
                <div class="service-price">From <span id="dynamic-price">$--</span><span>/month</span></div>
              </div>
            </div>
            <div class="service-divider">+</div>
            <div class="service-item">
              <div class="service-icon">üì¶</div>
              <div class="service-content">
                <h4>Insole Delivery Service</h4>
                <p>Fresh insoles shipped automatically every 6 months</p>
                <div class="service-price">Included<span>$59 value each</span></div>
              </div>
            </div>
          </div>
           -->
          <div class="trust-signals">
            <!-- <div class="trust-item">
              <span class="trust-icon">‚úì</span>
              <span>30-day money-back guarantee</span>
            </div> -->
            <div class="trust-item">
              <span class="trust-icon">‚úì</span>
              <span>Cancel anytime</span>
            </div>
            <div class="trust-item">
              <span class="trust-icon">‚úì</span>
              <span>No hidden fees or shipping costs</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Subscription Plans -->
      <section class="card subscription-section" aria-labelledby="subscription-heading">
        <div class="section-header">
          <h2 id="subscription-heading">Choose Your AI Running Coach Plan</h2>
          <p class="section-subtitle">All plans include smart sensor hardware, AI coaching, and automatic insole delivery:</p>
          
          <!-- <div class="features-grid">
            <div class="feature-item">
              <span class="feature-icon">üéØ</span>
              <span>Personalized training plans</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üìä</span>
              <span>Advanced performance analytics</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üõ°Ô∏è</span>
              <span>Injury prevention insights</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">‚ö°</span>
              <span>Real-time coaching feedback</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üì¶</span>
              <span>Automatic insole delivery</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üîÑ</span>
              <span>Full warranty coverage</span>
            </div>
          </div> -->
        </div>

        <div class="subscription-grid">
          <!-- Pro Plan (Recommended) -->
          <div class="subscription-card recommended pro-plan" data-subscription-id="coaching-pro">
            <div class="subscription-header">
              <div class="plan-badge">Most Popular</div>
              <h3>Pro AI Running Coach</h3>
              <p class="subscription-description">Maximum performance with premium delivery</p>
            </div>
            <div class="subscription-content">
              <div class="subscription-pricing">
                <div class="subscription-price">$19.99</div>
                <div class="subscription-interval">per month (billed annually)</div>
                <!-- <div class="total-savings">Save $99 vs monthly billing</div> -->
              </div>
              <div class="subscription-features">
                <div class="feature-highlight pro-highlight">
                  <div class="insole-benefit">
                    <span class="benefit-icon">üöÄ</span>
                    <strong>4 Sensing Insoles/Year</strong>
                    <span class="benefit-detail">$196 value - Priority shipping, quarterly delivery</span>
                  </div>
                </div>
                <ul>
                  <li><strong>Enhanced AI coaching algorithms, powered by the best model (GPT-4.1/O3)</strong></li>
                  <li><strong>Professional physical therapy reviews of your runs each quarter</strong></li>
                  <li><strong>Priority support, early access to new hardware/features</strong></li>
                  <li><strong>Fresh insoles delivered to your door quarterly</strong></li>
                  <li>All standard features included</li>
                </ul>
              </div>
              <div class="subscription-checkbox">
                <input type="radio" id="subscription-pro" name="subscription" value="coaching-pro" class="subscription-radio-input">
                <label for="subscription-pro" class="subscription-label">Choose Pro Coach</label>
              </div>
            </div>
          </div>

          <!-- Standard Plan -->
          <div class="subscription-card" data-subscription-id="coaching-annual">
            <div class="subscription-header">
              <h3>Standard AI Running Coach</h3>
              <p class="subscription-description">Essential coaching with regular insole delivery</p>
            </div>
            <div class="subscription-content">
              <div class="subscription-pricing">
                <div class="price-comparison">
                  <span class="regular-price">$16.50/mo</span>
                  <div class="subscription-price">$12.99</div>
                  <span class="save-amount">Save $39/year</span>
                </div>
                <div class="subscription-interval">per month (billed annually)</div>
              </div>
              <div class="subscription-features">
                <div class="feature-highlight">
                  <div class="insole-benefit">
                    <span class="benefit-icon">üì¶</span>
                    <strong>2 Sensing Insoles/Year</strong>
                    <span class="benefit-detail">$98 value - Standard delivery (7-10 days)</span>
                  </div>
                </div>
                <ul>
                  <li>AI-powered coaching feedback, by GPT-4o</li>
                  <li>  Real-time coaching feedback</li>
                  <li>Customized training plans</li>
                  <li>Injury prevention insights</li>
                  <li>Automatic insole delivery, <strong>Always get most updated sensors</strong></li>
                  <li>Email support</li>
                </ul>
              </div>
              <div class="subscription-checkbox">
                <input type="radio" id="subscription-annual" name="subscription" value="coaching-annual" class="subscription-radio-input">
                <label for="subscription-annual" class="subscription-label">Choose Standard Coach</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Alternative Option Toggle -->
        <div class="alternative-option">
          <button type="button" id="show-shorter-option" class="alternative-toggle">
            Need a shorter commitment? <span class="toggle-arrow">‚Üì</span>
          </button>
          
          <div id="shorter-option" class="shorter-option hidden">
            <div class="subscription-card-compact alternative-layout" data-subscription-id="coaching-6month">
              <div class="compact-header">
                <div class="compact-title-section">
                  <h3 style="text-align: left;">6-Month AI Running Coach</h3>
                  <p class="compact-description">Essential coaching with flexible commitment</p>
                </div>
                <div class="compact-pricing-section">
                  <div class="compact-price">$16.50<span class="price-period">/mo</span></div>
                  <div class="compact-billing">Billed every 6 months</div>
                  <div class="compact-note">Higher rate for flexibility</div>
                </div>
              </div>
              
              <div class="compact-content">
                <div class="compact-highlight">
                  <span class="compact-icon">üì¶</span>
                  <div class="compact-benefit">
                    <strong>1 Smart Insole Every 6 Months</strong>
                    <span class="compact-detail">$59 value ‚Ä¢ Standard delivery (7-10 days)</span>
                  </div>
                </div>
<!--                 
                <div class="compact-features">
                  <div class="feature-grid">
                    <div class="feature-item-compact">‚úì AI coaching (GPT-4o)</div>
                    <div class="feature-item-compact">‚úì Real-time feedback</div>
                    <div class="feature-item-compact">‚úì Custom training plans</div>
                    <div class="feature-item-compact">‚úì Injury prevention</div>
                    <div class="feature-item-compact">‚úì Auto insole delivery</div>
                    <div class="feature-item-compact">‚úì Email support</div>
                  </div>
                </div>
                 -->
                <div class="compact-checkbox">
                  <input type="radio" id="subscription-6month" name="subscription" value="coaching-6month" class="subscription-radio-input">
                  <label for="subscription-6month" class="compact-button">Choose 6-Month Plan</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Add-ons Selection -->
      <section class="card" aria-labelledby="addons-heading">
        <div class="addon-header">
          <h2 id="addons-heading">‚úÖ Customize Your Kit ‚Äî Add Coaching Extras</h2>
          <button type="button" id="toggle-addons" class="toggle-button" aria-label="Toggle add-ons visibility">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-up">
              <path d="m18 15-6-6-6 6"/>
            </svg>
          </button>
        </div>

        <div id="addons-container">
          <div id="no-subscription-warning" class="warning">
            Please select an AI coach plan first to see available add-ons.
          </div>

          <div id="addons-grid" class="addons-grid">
            <!-- Extra Battery Pods -->
            <div class="addon-card" data-addon-id="battery-pods" data-price="21" data-name="Extra Pair of Battery Pods" data-description="~20 extra hours of battery life per pod.">
              <div class="addon-header">
                <div>
                  <h3>Extra Pair of Battery Pods</h3>
                  <p class="addon-description">Keep your training going with ~20 extra hours of battery life per pod. Perfect for long sessions or avoiding downtime.</p>
                </div>
                <div class="addon-price">$21</div>
              </div>
              <div class="addon-content">
                <div class="addon-checkbox">
                  <input type="checkbox" id="addon-battery-pods" class="addon-checkbox-input">
                  <label for="addon-battery-pods">Add to order</label>
                </div>
                <div class="quantity-control hidden">
                  <button type="button" class="quantity-btn minus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                  <span class="quantity">1</span>
                  <button type="button" class="quantity-btn plus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="16"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Extra Pair of Sensing Insoles -->
            <div class="addon-card" data-addon-id="extra-insoles" data-price="49" data-name="Extra Pair of Striv Sensing Insoles" data-description="Easily swap insoles between shoes.">
              <div class="addon-header">
                <div>
                  <h3>Extra Pair of Striv Sensing Insoles</h3>
                  <p class="addon-description">An extra pair of insoles (no electronics) to easily switch your sensors between shoes.</p>
                </div>
                <div class="addon-price">$49</div>
              </div>
              <div class="addon-content">
                <div class="addon-checkbox">
                  <input type="checkbox" id="addon-extra-insoles" class="addon-checkbox-input">
                  <label for="addon-extra-insoles">Add to order</label>
                </div>
                <div class="quantity-control hidden">
                  <button type="button" class="quantity-btn minus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                  <span class="quantity">1</span>
                  <button type="button" class="quantity-btn plus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="16"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- 3-Pack of Sensing Insoles -->
            <div class="addon-card" data-addon-id="3pack-insoles" data-price="129" data-name="Extra 3 Pairs of Striv Sensing Insoles" data-description="Easily swap between shoes or keep replacements handy. Includes 3 extra pairs - save $18.">
              <div class="addon-header">
                <div>
                  <h3>Extra 3 Pairs of Striv Sensing Insoles</h3>
                  <div class="addon-tags">
                    <span class="recommendation-tag">‚úÖ Great for shoe rotation</span>
                  </div>
                  <p class="addon-description">Easily swap between shoes or keep replacements handy. Includes 3 extra pairs - save $18.</p>
                </div>
                <div class="addon-price">$129</div>
              </div>
              <div class="addon-content">
                <div class="addon-checkbox">
                  <input type="checkbox" id="addon-3pack-insoles" class="addon-checkbox-input">
                  <label for="addon-3pack-insoles">Add to order</label>
                </div>
                <div class="quantity-control hidden">
                  <button type="button" class="quantity-btn minus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                  <span class="quantity">1</span>
                  <button type="button" class="quantity-btn plus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="16"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- 10-Pack of Sensing Insoles -->
            <div class="addon-card" data-addon-id="10pack-insoles" data-price="399" data-name="Extra 10 Pairs of Striv Sensing Insoles" data-description="Maximum flexibility across multiple shoes or stock up on replacements. Includes 10 extra pairs - save $91.">
              <div class="addon-header">
                <div>
                  <h3>Extra 10 Pairs of Striv Sensing Insoles</h3>
                  <p class="addon-description">Maximum flexibility across multiple shoes or stock up on replacements. Includes 10 extra pairs - save $91.</p>
                </div>
                <div class="addon-price">$399</div>
              </div>
              <div class="addon-content">
                <div class="addon-checkbox">
                  <input type="checkbox" id="addon-10pack-insoles" class="addon-checkbox-input">
                  <label for="addon-10pack-insoles">Add to order</label>
                </div>
                <div class="quantity-control hidden">
                  <button type="button" class="quantity-btn minus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                  <span class="quantity">1</span>
                  <button type="button" class="quantity-btn plus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="16"/>
                      <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Order Summary -->
      <section id="order-summary" class="card summary-card hidden" aria-labelledby="order-summary-heading">
        <h2 id="order-summary-heading">Order Summary</h2>
        
        <div class="summary-content">
          <!-- Product summary items will be inserted here -->
          <div id="product-summary">
            <!-- Individual product items will be inserted here dynamically -->
          </div>
          
          <div id="subscription-summary" class="summary-subscription hidden">
            <h3>AI Running Coach Subscription</h3>
            <div id="subscription-details" class="subscription-details"></div>
          </div>
          
          <div id="addons-summary" class="summary-addons hidden">
            <h3>Add-ons</h3>
            <div id="addons-list" class="addons-list"></div>
          </div>
          
          <div class="summary-totals">
            <div class="summary-item">
              <span>Today's payment</span>
              <span id="onetime-total">$0</span>
            </div>
            <div class="summary-item subscription-total">
              <span>Then monthly</span>
              <span id="recurring-total">$0</span>
            </div>
          </div>
          
          <div class="summary-guarantee">
            <span class="guarantee-icon">üõ°Ô∏è</span>
            <span>Cancel anytime ‚Ä¢ Free insole delivery</span>
          </div>
        </div>
      </section>

      <div id="error-message" class="error-message hidden" role="alert">
        Please select an AI running coach plan to continue
      </div>

      <div class="checkout-button-container">
        <button type="submit" id="checkout-button" class="checkout-button" disabled>
          <span class="button-text">Select AI Coach Plan to Continue</span>
          <span class="button-icon">‚Üí</span>
        </button>
        
        <div class="checkout-security">
          <span class="security-icon">üîí</span>
          <span>Secure checkout powered by Stripe</span>
        </div>
      </div>
    </form>
  </main>

  <script src="script.js"></script>
  
  <!-- Centralized product and pricing data -->
  <script>
    // Centralize backend URL
    //window.strivBaseUrl = 'https://striv-backend-6a56be51e868.herokuapp.com';
    window.strivBaseUrl = 'http://localhost:8000';

    // Add loading state styling
    const loadingStyle = document.createElement('style');
    loadingStyle.textContent = `
      .container.loading::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.7);
        z-index: 1000;
      }
      
      .container.loading::after {
        content: 'Loading...';
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 1rem 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1001;
        font-weight: 600;
        font-family: var(--font-family);
      }

      .pricing-notice {
        position: relative;
        margin-bottom: 1rem;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
        background-color: #f8f9fa;
        border-left: 4px solid #6c757d;
        color: #495057;
        animation: slideDown 0.3s ease-out;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        font-family: var(--font-family);
      }

      .pricing-notice.warning {
        border-left-color: #f0ad4e;
        background-color: #fff9f0;
      }

      .pricing-notice .refresh-button {
        background: none;
        border: none;
        color: var(--accent-color);
        padding: 0.25rem 0.5rem;
        font-size: 0.85rem;
        cursor: pointer;
        border-radius: 4px;
        font-weight: 500;
        font-family: var(--font-family);
      }

      .pricing-notice .refresh-button:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      @keyframes slideDown {
        from { 
          opacity: 0;
          transform: translateY(-10px);
        }
        to { 
          opacity: 1;
          transform: translateY(0);
        }
      }
    `;
    document.head.appendChild(loadingStyle);

    // Track if we're using backend or fallback prices
    window.usingFallbackPrices = false;

    // Function to fetch pricing data from backend
    async function fetchPricingData() {
      // Before fetching, disable the checkout button
      const checkoutButton = document.getElementById('checkout-button');
      if (checkoutButton) {
        checkoutButton.disabled = true;
        checkoutButton.querySelector('.button-text').textContent = "Loading prices...";
      }
      
      // Remove any existing pricing notice
      const existingNotice = document.querySelector('.pricing-notice');
      if (existingNotice) {
        existingNotice.remove();
      }
      
      // Show loading state
      document.querySelector('.container').classList.add('loading');
      
      try {
        // In production, this would be your actual backend URL
        const backendUrl = `${window.strivBaseUrl}/api/pricing?checkout_type=subscription`;
        const response = await fetch(backendUrl);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch pricing data: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        // Store pricing data in global object
        window.strivData = data;
        
        // Update the UI with fetched pricing
        updateProductDisplay();
        
        // We're using backend prices
        window.usingFallbackPrices = false;
        
        return data;
      } catch (error) {
        console.error('Error fetching pricing data:', error);
        
        // Show pricing warning notification
        showPricingNotice();
        
        // Fallback to default pricing data if fetch fails
        window.strivData = {
          products: {
            "sensor-base": {
              name: "Striv‚Ñ¢ Smart Sensor",
              description: "Essential sensor hardware for advanced running analytics",
              price: 129,
              type: "one-time"
            }
          },
          subscriptions: {
            "coaching-6month": {
              name: "6-Month AI Running Coach",
              description: "Try our AI coaching system with flexibility",
              price: 16.50,
              monthlyPrice: 16.50,
              totalPrice: 99,
              interval: "month",
              billingInterval: "every 6 months",
              interval_count: 6,
              type: "subscription"
            },
            "coaching-annual": {
              name: "Standard AI Running Coach", 
              description: "Essential coaching with regular insole delivery",
              price: 12.99,
              monthlyPrice: 13.25,
              totalPrice: 159,
              regularPrice: 16.50,
              regularTotalPrice: 198,
              interval: "month",
              billingInterval: "annually",
              interval_count: 12,
              type: "subscription"
            },
            "coaching-pro": {
              name: "Pro AI Running Coach",
              description: "Maximum performance with premium delivery",
              price: 19.99,
              monthlyPrice: 19.99,
              totalPrice: 239.88,
              interval: "month",
              billingInterval: "annually",
              interval_count: 12,
              type: "subscription",
              recommended: true
            }
          },
          addons: {
            "battery-pods": {
              name: "Extra Pair of Battery Pods",
              description: "Keep your training going with ~20 extra hours of battery life per pod. Perfect for long sessions or avoiding downtime.",
              price: 21,
              regularPrice: 21,
              onSale: false
            },
            "extra-insoles": {
              name: "Extra Pair of Striv Sensing Insoles",
              description: "An extra pair of insoles (no electronics) to easily switch your sensors between shoes.",
              price: 49,
              regularPrice: 59,
              onSale: true
            },
            "3pack-insoles": {
              name: "Extra 3 Pairs of Striv Sensing Insoles",
              description: "Easily swap between shoes or keep replacements handy. Includes 3 extra pairs - save $18.",
              price: 129,
              regularPrice: 147,
              onSale: true
            },
            "10pack-insoles": {
              name: "Extra 10 Pairs of Striv Sensing Insoles",
              description: "Maximum flexibility across multiple shoes or stock up on replacements. Includes 10 extra pairs - save $91.",
              price: 399,
              regularPrice: 490,
              onSale: true
            }
          }
        };
        
        // Set flag that we're using fallback prices
        window.usingFallbackPrices = true;
        
        // Still update the UI with fallback data
        updateProductDisplay();
      } finally {
        // Hide loading state
        document.querySelector('.container').classList.remove('loading');
        
        // Re-enable the checkout button if we have data (even if it's fallback data)
        if (checkoutButton && window.strivData) {
          checkoutButton.disabled = true; // Keep disabled until product selected
          checkoutButton.querySelector('.button-text').textContent = "Select AI Coach Plan to Continue"; // Reset text to default
        }
      }
    }

    // Function to show pricing notice
    function showPricingNotice() {
      const header = document.querySelector('.header');
      if (!header) return;
      
      const notice = document.createElement('div');
      notice.className = 'pricing-notice warning';
      notice.innerHTML = `
        <span>Using estimated prices. Latest pricing unavailable.</span>
        <button class="refresh-button" onclick="fetchPricingData()">
          Refresh Prices
        </button>
      `;
      
      // Insert after header
      header.parentNode.insertBefore(notice, header.nextSibling);
    }

    // Function to update the HTML with pricing data
    function updateProductDisplay() {
      // Update the main dynamic price display at the top of the page
      const dynamicPriceEl = document.getElementById('dynamic-price');
      if (dynamicPriceEl && window.strivData?.subscriptions) {
        // Find the cheapest subscription price to display
        let cheapestPrice = Infinity;
        for (const [id, data] of Object.entries(window.strivData.subscriptions)) {
          const price = data.monthlyPrice || data.price;
          if (price < cheapestPrice) {
            cheapestPrice = price;
          }
        }
        if (cheapestPrice !== Infinity) {
          dynamicPriceEl.textContent = `$${parseFloat(cheapestPrice).toFixed(0)}`;
        }
      }

      // Update hardware price display
      const hardwarePriceEl = document.querySelector('.hardware-price .price-value');
      if (hardwarePriceEl && window.strivData?.products?.['sensor-base']) {
        const sensorPrice = window.strivData.products['sensor-base'].price;
        hardwarePriceEl.textContent = `$${parseFloat(sensorPrice).toFixed(0)}`;
      }

      // Initialize product details from central data
      for (const [id, data] of Object.entries(window.strivData.products)) {
        const productEl = document.querySelector(`.product-card[data-product-id="${id}"]`);
        if (productEl) {
          // Update product details in the HTML
          productEl.querySelector('h3').textContent = data.name;
          productEl.querySelector('.product-description').textContent = data.description;
          productEl.querySelector('.product-price').textContent = `$${data.price}`;
        }
      }

      // Initialize subscription details from central data
      for (const [id, data] of Object.entries(window.strivData.subscriptions)) {
        const subscriptionEl = document.querySelector(`.subscription-card[data-subscription-id="${id}"]`);
        if (subscriptionEl) {
          // Update subscription details in the HTML
          subscriptionEl.querySelector('h3').textContent = data.name;
          subscriptionEl.querySelector('.subscription-description').textContent = data.description;
          
          // Update pricing
          const priceEl = subscriptionEl.querySelector('.subscription-price');
          const intervalEl = subscriptionEl.querySelector('.subscription-interval');
          
          // ‰ΩøÁî®monthlyPrice‰Ωú‰∏∫ÊòæÁ§∫‰ª∑Ê†ºÔºàÂ¶ÇÊûúÂèØÁî®Ôºâ
          const displayPrice = data.monthlyPrice || data.price;
          
          if (data.regularPrice && data.regularPrice > displayPrice) {
            const priceContainer = subscriptionEl.querySelector('.subscription-pricing');
            const saveAmount = ((data.regularPrice - displayPrice) * 12).toFixed(0);
            priceContainer.innerHTML = `
              <div class="price-comparison">
                <span class="regular-price">$${parseFloat(data.regularPrice).toFixed(2)}/mo</span>
                <div class="subscription-price">$${parseFloat(displayPrice).toFixed(2)}</div>
                <span class="save-amount">Save $${saveAmount}/year</span>
              </div>
              <div class="subscription-interval">per month (billed ${data.billingInterval})</div>
            `;
          } else {
            if (priceEl) priceEl.textContent = `$${parseFloat(displayPrice).toFixed(2)}`;
            if (intervalEl) intervalEl.textContent = `per month (billed ${data.billingInterval || data.interval})`;
          }
        }
      }

      // Initialize addon details from central data
      for (const [id, data] of Object.entries(window.strivData.addons || {})) {
        const addonEl = document.querySelector(`.addon-card[data-addon-id="${id}"]`);
        if (addonEl) {
          // Update addon details in the HTML
          addonEl.querySelector('h3').textContent = data.name;
          addonEl.querySelector('.addon-description').textContent = data.description;
          
          // Update price with sale information if applicable
          const priceEl = addonEl.querySelector('.addon-price');
          if (data.onSale && data.regularPrice > data.price) {
            const saveAmount = data.regularPrice - data.price;
            const savePercent = Math.round((saveAmount / data.regularPrice) * 100);
            
            priceEl.innerHTML = `
              <div class="price-container">
                <span class="regular-price">$${data.regularPrice}</span>
                <span class="sale-price">$${data.price}</span>
              </div>
            `;
          } else {
            priceEl.textContent = `$${data.price}`;
          }
          
          // Update data attributes as well
          addonEl.setAttribute('data-name', data.name);
          addonEl.setAttribute('data-description', data.description);
          addonEl.setAttribute('data-price', data.price);
        }
      }
    }

    // Fetch pricing data when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      fetchPricingData();
    });
  </script>
</body>
</html> 